-- 将筛选出的文旅企业数据存储到新表中，便于后续操作

-- 删除表，如果已存在
DROP TABLE IF EXISTS enterprises;

-- 创建 enterprises 表
CREATE TABLE enterprises AS
SELECT
    REG_ORG,            -- 登记机关
    COMP_TYPE,          -- 企业类型大类（中文）
    REG_STATE,          -- 登记状态（中文）
    UNI_SOCIAL_CRD_CD,  -- 统一社会信用代码
    COMP_NM,            -- 企业名称（字号名称）
    ADDR,               -- 住所（登记、个体户经营场所）
    LEGAL_REPRE,        -- 法定代表人(经营者姓名)
    INDV_ID,            -- 行业代码（中文）
    REG_CAPT,           -- 注册资本(资金数额)
    CAPT_KIND,          -- 币种
    OPT_SCOP,           -- 经营范围
    REG_NO,             -- 注册号
    APPR_DT,            -- 核准日期（登记、吊销、注销日期）
    EST_DT,             -- 成立日期
    OPT_FROM,           -- 经营(营业)起始日期
    OPT_TO,             -- 经营(营业)截止日期
    DOMDI_STRICT,       -- 住所所在行政区划
    PRO_LOC,            -- 生产经营地
    OPT_STRICT,         -- 生产经营地所在行政区划
    POSTAL_CODE,        -- 邮政编码
    -- OPT_LOC,            -- 经营场所
    INDV_NM             -- 行业代码（中文）
FROM
    dw_zj_scjdgl_scztxx
WHERE
    INDV_NM IN (
        -- 文旅行业代码列表
        '0141', '0143', '0149', '0151', '0152', '0153', '0154', '0159',
        '0412', '1784', '1922', '2221', '2222', '2311', '2312', '2319',
        '2320', '2330', '2411', '2412', '2414', '2421', '2422', '2423',
        '2429', '2431', '2432', '2433', '2434', '2435', '2436', '2437',
        '2438', '2439', '2441', '2442', '2449', '2451', '2452', '2453',
        '2454', '2455', '2456', '2459', '2461', '2462', '2469', '2642',
        '2644', '2664', '2672', '3075', '3076', '3471', '3472', '3473',
        '3474', '3542', '3733', '3780', '3873', '3931', '3932', '3933',
        '3934', '3939', '3951', '3952', '3953', '3961', '3963', '3969',
        '5137', '5141', '5143', '5144', '5145', '5146', '5147', '5149',
        '5175', '5178', '5181', '5183', '5184', '5211', '5212', '5213',
        '5219', '5221', '5222', '5223', '5224', '5225', '5226', '5227',
        '5229', '5231', '5232', '5233', '5234', '5235', '5236', '5237',
        '5238', '5239', '5241', '5242', '5243', '5244', '5245', '5246',
        '5247', '5248', '5249', '5261', '5262', '5263', '5264', '5265',
        '5266', '5267', '5271', '5311', '5312', '5313', '5331', '5333',
        '5339', '5411', '5412', '5413', '5414', '5419', '5421', '5422',
        '5429', '5441', '5442', '5443', '5449', '5511', '5512', '5513',
        '5531', '5539', '5611', '5622', '5631', '5632', '5639', '5822',
        '5910', '6110', '6121', '6129', '6130', '6140', '6190', '6210',
        '6220', '6231', '6232', '6233', '6239', '6241', '6291', '6319',
        '6321', '6322', '6331', '6421', '6422', '6429', '6432', '6434',
        '6439', '6440', '6450', '6513', '6572', '6579', '6621', '6623',
        '6624', '6629', '6634', '6635', '6636', '6637', '6639', '6813',
        '6814', '6820', '6999', '7111', '7115', '7119', '7121', '7122',
        '7123', '7124', '7125', '7129', '7130', '7211', '7212', '7215',
        '7219', '7221', '7222', '7223', '7224', '7229', '7251', '7259',
        '7271', '7272', '7281', '7282', '7283', '7284', '7289', '7291',
        '7294', '7297', '7298', '7299', '7350', '7484', '7491', '7492',
        '7520', '7711', '7712', '7713', '7714', '7715', '7716', '7719',
        '7850', '7861', '7862', '7869', '8051', '8052', '8053', '8060',
        '8070', '8336', '8341', '8342', '8391', '8393', '8399', '8412',
        '8413', '8414', '8415', '8416', '8511', '8512', '8610', '8621',
        '8622', '8623', '8624', '8625', '8626', '8629', '8710', '8720',
        '8730', '8740', '8750', '8760', '8770', '8810', '8820', '8831',
        '8832', '8840', '8850', '8860', '8870', '8890', '8921', '8929',
        '8930', '9011', '9012', '9013', '9019', '9020', '9030', '9051',
        '9053', '9059', '9090', '9221', '9222', '9521', '9522', '9542'
    )
    AND (
        -- 经营范围关键词筛选
        OPT_SCOP LIKE '%文化%' OR
        OPT_SCOP LIKE '%多媒体%' OR
        OPT_SCOP LIKE '%游戏%' OR
        OPT_SCOP LIKE '%动漫%' OR
        OPT_SCOP LIKE '%数字出版%' OR
        OPT_SCOP LIKE '%建筑设计%' OR
        OPT_SCOP LIKE '%舞台%' OR
        OPT_SCOP LIKE '%婚庆%' OR
        OPT_SCOP LIKE '%娱乐%' OR
        OPT_SCOP LIKE '%版权%' OR
        OPT_SCOP LIKE '%会议%' OR
        OPT_SCOP LIKE '%展览%' OR
        OPT_SCOP LIKE '%广告%' OR
        OPT_SCOP LIKE '%工艺美术%' OR
        OPT_SCOP LIKE '%旅游%' OR
        OPT_SCOP LIKE '%出行%' OR
        OPT_SCOP LIKE '%游客%' OR
        OPT_SCOP LIKE '%观光%' OR
        OPT_SCOP LIKE '%游览%' OR
        OPT_SCOP LIKE '%旅行%' OR
        OPT_SCOP LIKE '%体育%' OR
        OPT_SCOP LIKE '%休闲%' OR
        OPT_SCOP LIKE '%公共交通%' OR
        OPT_SCOP LIKE '%健康%' OR
        OPT_SCOP LIKE '%休养%' OR
        OPT_SCOP LIKE '%会展%' OR
        OPT_SCOP LIKE '%翻译%' OR
        OPT_SCOP LIKE '%健身%' OR
        OPT_SCOP LIKE '%保健%' OR
        OPT_SCOP LIKE '%酒店%'
    )
ORDER BY
    UNI_SOCIAL_CRD_CD;

-- ==============================

-- 显示创建结果
SELECT
    COUNT(*) AS total_enterprises,
    COUNT(DISTINCT INDV_NM) AS unique_industry_codes,
    COUNT(DISTINCT COMP_TYPE) AS unique_company_types,
    COUNT(DISTINCT DOMDI_STRICT) AS unique_districts
FROM
    enterprises;

-- 显示表结构
DESCRIBE enterprises;

-- 显示被选中的企业数量
SELECT COUNT(*) AS selected_enterprises_count FROM enterprises;

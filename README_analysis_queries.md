# 文旅企业分析查询文件夹说明

本项目包含两个分析查询文件夹，分别适用于不同的工作环境：

## 📁 cloud_server_queries（云服务器环境）

### 适用场景
- 通过堡垒机连接云服务器上的MySQL数据库
- 无法上传Excel、CSV等文档
- 所有行业代码和数据列表必须硬编码在SQL中

### 文件结构
```
cloud_server_queries/
├── step1_get_enterprises_directly.sql      # 直接查询文旅企业（硬编码行业代码）
├── step2_add_enterprise_dimensions.sql     # 增加企业信息维度（硬编码行业代码）
└── step3_statistical_analysis.sql          # 统计分析（基于硬编码数据）
```

### 特点
- ✅ 行业代码列表硬编码在SQL中
- ✅ 经营范围关键词硬编码在SQL中
- ✅ 无需外部文件依赖
- ✅ 可直接在堡垒机环境中执行
- ✅ 适用于生产环境

### 使用方法
1. 将SQL文件复制到云服务器
2. 直接在MySQL客户端中执行
3. 按顺序执行：step1 → step2 → step3

---

## 📁 local_validation_queries（本地验证环境）

### 适用场景
- 本地开发环境
- 可以读取CSV文件
- 用于验证操作思路和过程
- 便于调试和测试

### 文件结构
```
local_validation_queries/
├── step1_get_enterprises_from_csv.sql      # 从CSV读取文旅企业数据
├── step2_add_enterprise_dimensions.sql     # 增加企业信息维度（基于CSV）
└── step3_statistical_analysis.sql          # 统计分析（基于CSV数据）
```

### 特点
- ✅ 从CSV文件读取行业代码列表
- ✅ 支持动态更新行业代码
- ✅ 便于本地验证和调试
- ✅ 支持白名单企业管理
- ✅ 适用于开发测试环境

### 依赖文件
需要以下CSV文件存在于 `codes/` 目录：
- `cultural_industry_codes.csv` - 文化产业行业代码
- `tourism_industry_codes.csv` - 旅游产业行业代码
- `social_credit_codes.csv` - 白名单企业社会信用代码

### 使用方法
1. 确保CSV文件存在于正确位置
2. 在本地MySQL环境中执行
3. 按顺序执行：step1 → step2 → step3

---

## 🔄 工作流程对比

### 云服务器环境流程
```
1. 硬编码行业代码 → 2. 直接查询数据库 → 3. 统计分析
```

### 本地验证环境流程
```
1. 读取CSV文件 → 2. 动态查询数据库 → 3. 统计分析
```

---

## 📊 分析步骤说明

### Step1：获取文旅市场主体数据
- 从基础企业表中筛选文旅相关企业
- 根据行业代码和经营范围进行筛选
- 输出基础企业信息

### Step2：增加企业信息维度
- 关联法定代表人信息
- 关联经营异常、违法失信信息
- 关联财务、社保、纳税等信息
- 输出完整的企业画像数据

### Step3：统计分析
- 企业数量统计
- 经营状况分析
- 风险企业分析
- 社保参与度分析
- 行业分布统计

---

## ⚠️ 注意事项

1. **环境适配**：确保在正确的环境中使用对应的查询文件
2. **数据安全**：云服务器环境中注意数据安全，避免敏感信息泄露
3. **文件路径**：本地环境中确保CSV文件路径正确
4. **权限设置**：确保数据库用户有足够的查询权限
5. **性能优化**：大数据量时注意查询性能，可能需要分批处理

---

## 🔧 维护说明

### 更新行业代码
- **云服务器环境**：直接修改SQL文件中的硬编码列表
- **本地环境**：更新对应的CSV文件

### 添加新的分析维度
- 在两个环境中同步更新Step2文件
- 确保字段映射一致

### 优化查询性能
- 根据实际数据量调整查询策略
- 考虑添加适当的索引
- 必要时进行查询优化